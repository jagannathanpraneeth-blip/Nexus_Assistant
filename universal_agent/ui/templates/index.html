<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Digital Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0f172a',
                        secondary: '#1e293b',
                        accent: '#38bdf8',
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-primary text-white font-sans antialiased">
    <div class="container mx-auto px-4 py-8">
        <header class="flex justify-between items-center mb-10">
            <div>
                <h1 class="text-3xl font-bold tracking-tight text-accent">Universal Digital Agent</h1>
                <p class="text-gray-400 text-sm mt-1">Production Ready • Multi-Modal • Autonomous</p>
            </div>
            <div class="flex items-center space-x-4">
                <div class="flex items-center">
                    <span class="h-3 w-3 rounded-full bg-green-500 animate-pulse mr-2"></span>
                    <span class="text-sm font-medium text-green-400">System Active</span>
                </div>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Task Input -->
            <div class="lg:col-span-1 bg-secondary rounded-xl p-6 shadow-lg border border-gray-700">
                <h2 class="text-xl font-semibold mb-4 text-white">New Command</h2>
                <textarea id="taskInput"
                    class="w-full h-32 bg-gray-900 border border-gray-700 rounded-lg p-3 text-sm text-gray-300 focus:ring-2 focus:ring-accent focus:outline-none resize-none"
                    placeholder="Describe your task here..."></textarea>
                <button onclick="submitTask()"
                    class="w-full mt-4 bg-accent hover:bg-sky-500 text-primary font-bold py-2 px-4 rounded-lg transition duration-200">
                    Execute
                </button>
            </div>

            <!-- Active Tasks -->
            <div class="lg:col-span-2 bg-secondary rounded-xl p-6 shadow-lg border border-gray-700">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-white">Task Queue</h2>
                    <button onclick="fetchTasks()" class="text-xs text-gray-400 hover:text-white">Refresh</button>
                </div>
                <div id="taskList" class="space-y-3 max-h-[600px] overflow-y-auto pr-2">
                    <!-- Tasks will be injected here -->
                    <div class="animate-pulse flex space-x-4">
                        <div class="flex-1 space-y-4 py-1">
                            <div class="h-4 bg-gray-700 rounded w-3/4"></div>
                            <div class="space-y-2">
                                <div class="h-4 bg-gray-700 rounded"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        async function submitTask() {
            const input = document.getElementById('taskInput');
            const description = input.value.trim();
            if (!description) return;

            try {
                const response = await fetch('/api/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ description }),
                });

                if (response.ok) {
                    input.value = '';
                    fetchTasks();
                } else {
                    alert('Failed to submit task');
                }
            } catch (error) {
                console.error('Error submitting task:', error);
                alert('Error submitting task');
            }
        }

        async function fetchTasks() {
            try {
                const response = await fetch('/api/tasks');
                const tasks = await response.json();
                renderTasks(tasks);
            } catch (error) {
                console.error('Error fetching tasks:', error);
            }
        }

        function renderTasks(tasks) {
            const container = document.getElementById('taskList');
            container.innerHTML = '';

            if (tasks.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No active tasks.</p>';
                return;
            }

            tasks.forEach(task => {
                const statusColors = {
                    'pending': 'bg-yellow-500/20 text-yellow-400 border-yellow-500/50',
                    'running': 'bg-blue-500/20 text-blue-400 border-blue-500/50',
                    'completed': 'bg-green-500/20 text-green-400 border-green-500/50',
                    'failed': 'bg-red-500/20 text-red-400 border-red-500/50'
                };

                const statusClass = statusColors[task.status] || 'bg-gray-500/20 text-gray-400';

                const html = `
                    <div class="bg-gray-900/50 rounded-lg p-4 border border-gray-800 hover:border-gray-600 transition duration-200">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-medium text-gray-200">${task.description}</h3>
                                <p class="text-xs text-gray-500 mt-1">ID: ${task.id}</p>
                            </div>
                            <span class="px-2 py-1 rounded text-xs font-medium border ${statusClass}">
                                ${task.status.toUpperCase()}
                            </span>
                        </div>
                        ${task.result ? `<div class="mt-3 text-sm text-gray-400 bg-black/30 p-2 rounded border border-gray-800 font-mono">${task.result}</div>` : ''}
                        ${task.error ? `<div class="mt-3 text-sm text-red-400 bg-red-900/10 p-2 rounded border border-red-900/30">${task.error}</div>` : ''}
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        // Poll every 2 seconds
        setInterval(fetchTasks, 2000);
        fetchTasks();
    </script>
</body>

</html>